<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Players</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<style>
    body {
        font-family: 'Poppins', sans-serif;
        margin: 0;
        display: flex;
    }


    .wrapper {
        display: flex;
        flex: 1;
    }

    .sidebar {
        width: 250px;
        padding: 15px;
        background-color: #f4f4f4;
        border-right: 1px solid #ddd;
        overflow-y: auto;
        position: fixed;
    }

    .home-sidebar {
        left: 0;
        height: 100%;
    }

    .filter-sidebar {
        right: 0;
        height: 100%;
        background-color: #eaeaea;
        border-left: 1px solid #ddd;
    }

    .content {
        margin: 0 270px;
        /* Width of both sidebars plus padding */
        padding: 20px;
        flex-grow: 1;
    }

    .team-logo {
        width: 100%;
        max-width: 200px;
        display: block;
        margin: 0 auto 15px;
    }

    .toggle-btn {
        position: fixed;
        top: 10px;
        padding: 5px 10px;
        background: #007bff;
        color: white;
        border: none;
        cursor: pointer;
        z-index: 10;
    }

    #homeToggleBtn {
        left: 250px;
        /* Same as home-sidebar width */
    }

    #filterToggleBtn {
        right: 250px;
        /* Same as filter-sidebar width */
    }

    .team-logo {
        width: 100%;
        height: auto;
        margin-bottom: 20px;
    }

    .main-content {
        flex: 1;
        padding: 20px;
    }

    .player-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
    }

    .player-card {
        background: #ffffff;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        text-align: center;
    }

    .player-card img {
        width: 100px;
        height: auto;
        border-radius: 50%;
    }

    button {
        background: #61dafb;
        color: #000;
        font-weight: bold;
        cursor: pointer;
    }

    /* Player Card Styles */
    .player-card {
        position: relative;
        transition: all 0.3s ease;
    }

    .player-card.selected {
        box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
        transform: scale(1.02);
    }

    .selection-overlay {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 2;
    }

    .player-select {
        width: 20px;
        height: 20px;
        cursor: pointer;
    }

    /* Selected Players Bar */
    .selected-players-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: white;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        padding: 15px;
        z-index: 1000;
    }

    .selected-players-container {
        display: flex;
        gap: 10px;
        overflow-x: auto;
        padding-bottom: 10px;
    }

    .selected-player-thumbnail {
        position: relative;
        flex-shrink: 0;
        width: 60px;
        text-align: center;
    }

    .selected-player-thumbnail img {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
    }

    .selected-player-thumbnail p {
        font-size: 0.8em;
        margin-top: 5px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .selection-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 10px;
    }

    /* Crystal Effect for Selected Players */
    .player-card.selected::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(45deg,
                rgba(0, 255, 0, 0.1),
                rgba(0, 255, 0, 0.2));
        pointer-events: none;
        z-index: 1;
    }

    /* Buttons */
    #saveTeamBtn,
    #viewTeamBtn {
        padding: 8px 16px;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    #saveTeamBtn {
        background-color: #4CAF50;
        color: white;
    }

    #saveTeamBtn:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
    }

    #viewTeamBtn {
        background-color: #2196F3;
        color: white;
        margin-left: 10px;
    }

    /* Success Message */
    .success-message {
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: #4CAF50;
        color: white;
        padding: 15px 25px;
        border-radius: 4px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        animation: slideIn 0.3s ease-out;
        z-index: 1001;
    }

    @keyframes slideIn {
        from {
            transform: translateY(-100%);
            opacity: 0;
        }

        to {
            transform: translateY(0);
            opacity: 1;
        }
    }
</style>

<body>
    <div class="wrapper">
        <!-- Home Sidebar -->
        <div class="sidebar home-sidebar" id="homeSidebar">
            <a class="navbar-brand" href="#">Pitcher Perfect ‚öæ</a>
            <a href="{{ url_for('home') }}">Team Details üèüÔ∏è</a>
            <a href="{{ url_for('team_players') }}">Team Players</a>
            <a href="#">Team Comparison</a>
            <a href="#">Minor League Players</a>
            <a href="#">Strategies</a>
        </div>
        <button class="toggle-btn left-toggle" id="homeToggleBtn">></button>
        <!-- Filter Sidebar -->
        <div class="sidebar filter-sidebar" id="filterSidebar">
            <img src="{{ team_logo }}" alt="Team Logo" class="team-logo">
            <h3>Filters</h3>
            <form method="GET" action="{{ url_for('team_players') }}">
                <!-- Team Name Filter -->
                <label for="team">Team Name:</label>
                <select name="team_id" id="team">
                    {% for league, divisions in team_mapping.items() %}
                    {% for division, teams in divisions.items() %}
                    <optgroup label="{{ league }} - {{ division }}">
                        {% for team in teams %}
                        <option value="{{ team.id }}" {% if team.id==selected_team %}selected{% endif %}>
                            {{ team.name }}
                        </option>
                        {% endfor %}
                    </optgroup>
                    {% endfor %}
                    {% endfor %}
                </select>

                <!-- Status Filter -->
                <label for="status">Status:</label>
                <select name="status" id="status">
                    <option value="All" {% if selected_status=='All' %}selected{% endif %}>All</option>
                    <option value="Active" {% if selected_status=='Active' %}selected{% endif %}>Active</option>
                    <option value="Minor League" {% if selected_status=='Minor League' %}selected{% endif %}>Minor
                        League</option>
                    <option value="Traded" {% if selected_status=='Traded' %}selected{% endif %}>Traded</option>
                </select>

                <!-- Role Filter -->
                <label for="role">Role:</label>
                <!-- Role Filter -->
                <label><input type="checkbox" name="roles" value="Pitcher" {% if 'Pitcher' in selected_roles %}checked{%
                        endif %}> Pitcher</label><br>
                <label><input type="checkbox" name="roles" value="Catcher" {% if 'Catcher' in selected_roles %}checked{%
                        endif %}> Catcher</label><br>
                <label><input type="checkbox" name="roles" value="First Baseman" {% if 'First Baseman' in selected_roles
                        %}checked{% endif %}> First Baseman</label><br>
                <label><input type="checkbox" name="roles" value="Second Baseman" {% if 'Second Baseman' in
                        selected_roles %}checked{% endif %}> Second Baseman</label><br>
                <label><input type="checkbox" name="roles" value="Third Baseman" {% if 'Third Baseman' in selected_roles
                        %}checked{% endif %}> Third Baseman</label><br>
                <label><input type="checkbox" name="roles" value="Shortstop" {% if 'Shortstop' in selected_roles
                        %}checked{% endif %}> Shortstop</label><br>
                <label><input type="checkbox" name="roles" value="Two-Way Player" {% if 'Two-Way Player' in
                        selected_roles %}checked{% endif %}> Two-Way Player</label><br>
                <label><input type="checkbox" name="roles" value="Outfielder" {% if 'Outfielder' in selected_roles
                        %}checked{% endif %}> Outfielder</label><br>           
                <button type="submit">Apply Filters</button>
            </form>
        </div>
        <div class="main-content">
            <h1>Team Players</h1>
            <div class="player-list">
                {% for player in players %}
                <div class="player-card" data-player='{{ player|tojson|safe }}'>
                    <div class="selection-overlay">
                        <input type="checkbox" class="player-select" />
                    </div>
                    <img src="{{ player.headshot_url }}" alt="{{ player.name }}" class="player-image">
                    <h3>{{ player.name }}</h3>
                    <p>{{ player.id }}</p>
                    <p>Jersey Number: {{ player.jersey_number }}</p>
                    <p>Position: {{ player.position }} ({{ player.type }})</p>
                    <p>Status: {{ player.status }}</p>
                    <p>Height: {{ player.height }} | Weight: {{ player.weight }}</p>
                </div>
                {% endfor %}
            </div>

            <!-- Selected Players Bar -->
            <div class="selected-players-bar">
                <div class="selected-players-container">
                    <!-- Selected players will be displayed here -->
                </div>
                <div class="selection-controls">
                    <span class="player-count">Selected: <span id="selectedCount">0</span>/26</span>
                    <button id="saveTeamBtn" disabled>Save Team</button>
                    <button id="viewTeamBtn">View Team</button>
                </div>
            </div>
        </div>
    </div>
    </div>
</body>
<script>
    document.addEventListener('DOMContentLoaded', function() {
    const selectedPlayers = new Set();
    const maxPlayers = 26;
    
    // Elements
    const playerCards = document.querySelectorAll('.player-card');
    const selectedPlayersContainer = document.querySelector('.selected-players-container');
    const saveTeamBtn = document.getElementById('saveTeamBtn');
    const viewTeamBtn = document.getElementById('viewTeamBtn');
    const selectedCountEl = document.getElementById('selectedCount');
    
    function updateSelectedPlayersBar() {
        selectedPlayersContainer.innerHTML = '';
        selectedPlayers.forEach(player => {
            const thumbnail = document.createElement('div');
            thumbnail.className = 'selected-player-thumbnail';
            thumbnail.innerHTML = `
                <img src="${player.headshot_url}" alt="${player.name}">
                <p>${player.name}</p>
            `;
            selectedPlayersContainer.appendChild(thumbnail);
        });
        
        selectedCountEl.textContent = selectedPlayers.size;
        saveTeamBtn.disabled = selectedPlayers.size !== maxPlayers;
    }
    
    function showSuccessMessage(message) {
        const messageEl = document.createElement('div');
        messageEl.className = 'success-message';
        messageEl.textContent = message;
        document.body.appendChild(messageEl);
        
        setTimeout(() => {
            messageEl.remove();
        }, 3000);
    }
    
    // Add click handlers to player cards
    playerCards.forEach(card => {
        const checkbox = card.querySelector('.player-select');
        const playerData = JSON.parse(card.dataset.player);
        
        checkbox.addEventListener('change', (e) => {
            if (e.target.checked) {
                if (selectedPlayers.size >= maxPlayers) {
                    e.target.checked = false;
                    alert(`You can only select up to ${maxPlayers} players`);
                    return;
                }
                selectedPlayers.add(playerData);
                card.classList.add('selected');
            } else {
                selectedPlayers.delete(playerData);
                card.classList.remove('selected');
            }
            updateSelectedPlayersBar();
        });
    });
    
    // Save team handler
    saveTeamBtn.addEventListener('click', async () => {
        try {
            const response = await fetch('/save_selected_team', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    players: Array.from(selectedPlayers)
                })
            });
            
            const data = await response.json();
            if (data.success) {
                showSuccessMessage(data.message);
            }
        } catch (error) {
            console.error('Error saving team:', error);
        }
    });
    
    // View team handler
    viewTeamBtn.addEventListener('click', () => {
        window.location.href = '/view_selected_team';
    });
});
</script>