<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Data Visualization</title>
    <!-- Bootstrap CSS for carousel functionality -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Plotly.js for chart creation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/plotly.js-dist@2.11.1"></script>
</head>

<body>
    <div class="container">
        <h1 class="my-4">Player Data Visualization</h1>

        <!-- Carousel for the charts -->
        <div id="chartCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner" id="carouselItems">
                <!-- Dynamic items will be injected here -->
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#chartCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#chartCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </div>

    <!-- Bootstrap JS (required for carousel to work) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script>

        // Function to fetch data from Flask and create charts
        async function fetchDataAndCreateCharts() {
            try {
                const response = await fetch('/get_data');
                const data = await response.json();

                const battersData = data.batters;
                const pitchersData = data.pitchers;

                const carouselItems = document.getElementById('carouselItems');

                // Generate charts
                const battersMaxHitSpeedPlot = generatePlot(battersData, 'Batters', 'max_hit_speed');
                const battersBarrelsPlot = generatePlot(battersData, 'Batters', 'barrels');
                const pitchersMaxHitSpeedPlot = generatePlot(pitchersData, 'Pitchers', 'max_hit_speed');
                const pitchersBarrelsPlot = generatePlot(pitchersData, 'Pitchers', 'barrels');

                // Append the plots as carousel items
                carouselItems.appendChild(battersMaxHitSpeedPlot);
                carouselItems.appendChild(battersBarrelsPlot);
                carouselItems.appendChild(pitchersMaxHitSpeedPlot);
                carouselItems.appendChild(pitchersBarrelsPlot);
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        // Call the function to fetch data and initialize charts on page load
        window.onload = fetchDataAndCreateCharts;

        // Function to generate the Plotly chart (unchanged)
        function generatePlot(data, title, metric) {
            const topPlayers = data.sort((a, b) => b[metric] - a[metric]).slice(0, 5);
            const xData = topPlayers.map(player => player['last_name, first_name']);
            const yData = topPlayers.map(player => player[metric]);

            const trace = {
                x: xData,
                y: yData,
                type: 'bar',
                marker: { color: 'skyblue' }
            };

            const layout = {
                title: `${title} - Top 5 by ${metric}`,
                xaxis: { title: 'Player Name' },
                yaxis: { title: metric },
            };

            const plotDiv = document.createElement('div');
            plotDiv.classList.add('carousel-item');
            if (metric === 'max_hit_speed') {
                plotDiv.classList.add('active');
            }

            // Generate the plot
            Plotly.newPlot(plotDiv, [trace], layout);

            return plotDiv;
        }
    </script>


</body>

</html>